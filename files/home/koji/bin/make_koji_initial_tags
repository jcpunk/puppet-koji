#!/bin/bash
####################################################
#
# HEADER: This file was autogenerated by puppet.
#
# FILE: modules/koji/files/root/bin/make_koji_initial_tags
#
# /home/koji/bin/make_koji_initial_tags file for machine [<%= fqdn %>]
#
#####################################################

# required packages for making more or less anything compile
# yum is on the end as you can't have an SL system without
# yum so it wont pull in any funny requires while making it
# much easier to fixup a buildroot if it needs a little help
KOJI_BUILD_BASE_PACKAGES='bash bzip2 coreutils cpio diffutils findutils gawk gcc gcc-c++ grep gzip info make patch redhat-release redhat-rpm-config rpm-build sed shadow-utils tar unzip util-linux-ng which yum xz buildsys-macros-dist-dynamic'

KOJI_BUILD_SRPM_BASE_PACKAGES='bash curl cvs git gnupg2 make redhat-release redhat-rpm-config rpm-build shadow-utils buildsys-macros-dist-dynamic'

KOJI_BUILD_LIVECD_BASE_PACKAGES='bash bzip2 coreutils cpio diffutils findutils gawk gcc gcc-c++ grep gzip info livecd-tools make patch policycoreutils python-dbus redhat-logos redhat-release redhat-rpm-config rpm-build sed selinux-policy-targeted shadow-utils squashfs-tools tar unzip util-linux which yum buildsys-macros-dist-dynamic'

# setup args in the right order for making getopt evaluation
# nice and easy.  You'll need to read the manpages for more info
args=$(getopt -o h -- "$@")
eval set -- "$args"

usage() {
    echo "$0: [-h]" >&2
    echo '' >&2
    echo '  Make the initial koji build tags.' >&2
    echo '  These should be the parent tags for' >&2
    echo '  your actual build tags, they are here' >&2
    echo '  to provide structure.' >&2
    echo '' >&2
    echo '  You will need to add your own tags.' >&2
    echo '  They can inherit the config from these,' >&2
    echo '  but make sure to add your custom changes too!' >&2
    echo '' >&2
    
    exit 1
}

for arg in $@; do
    case $1 in
        -- )
            # end of getopt args, shift off the -- and get out of the loop
            shift
            break 2
           ;;
         -h )
            # get help
            usage
           ;;
    esac
done

koji list-tags |grep 'My_Linux' >/dev/null 2>&1
if [[ $? -eq 0 ]]; then
    echo "Looks like we've already got the initial tags" >&2
    echo "So I'm doing nothing" >&2
    exit 1
fi

# need this tag if we ever want garbage collection
koji add-tag trashcan

koji add-tag My_Linux

koji add-tag --arches "x86_64,i686" My_Linux-build

koji add-group My_Linux-build build
koji add-group-pkg  My_Linux-build build $KOJI_BUILD_BASE_PACKAGES

koji add-group My_Linux-build srpm-build
koji add-group-pkg My_Linux-build srpm-build $KOJI_BUILD_SRPM_BASE_PACKAGES

koji add-group My_Linux-build livecd-build
koji add-group-pkg My_Linux-build livecd-build $KOJI_BUILD_LIVECD_BASE_PACKAGES

